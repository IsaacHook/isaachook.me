<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <!-- Latest compiled JavaScript -->
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <link href="weatherApp.css" rel="stylesheet">
    </head>
    <body>
        <!-- Google Tag Manager -->
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-P38W7H"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-P38W7H');</script>
        <!-- End Google Tag Manager -->

        <script>
        $(document).ready(function() {
            var flickrAPIKey = "c99dce790c50ea925f9c32b675af11ea";
            var flickrAPISecret = "5a720f44196a208c";
            var flickrUserId = "140455243@N02";
            var temperature = 0;
            var displayTemperature = 0;

            function success(position) {
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;

                var openWeatherURL = "http://api.openweathermap.org/data/2.5/weather?lat=" + latitude + "&lon=" + longitude + "&APPID=573b51c402dc03733db43f69c8f7e355&units=metric";

                //just in case the tags fails..
                var tags = "cat";

                $.getJSON(openWeatherURL, function(data) {
                    console.log(data);
                    tags = data.weather[0].description;
                    tags = tags.split(' ' ).join('+');
                    $(".location").html(data.name);
                    temperature = data.main.temp;
                    displayTemperature = data.main.temp;
                    $(".temperature").html(temperature + "&deg" + "C");
                    weather = data.weather[0].description;
                    weather = weather.replace(/\w+/g,function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()});
                    
                    $(".weather").html(weather);



                    var flickrAPIURL = "https://api.flickr.com/services/rest/?method=flickr.photos.search&sort=relevance&format=json&jsoncallback=?&api_key=" + flickrAPIKey + "&tags=" + tags;
                        //to make pictures local
                        // + "&lat=" + latitude + "&lon=" + longitude + "&radius=30";
                    console.log(flickrAPIURL);
                    
                    $.getJSON(flickrAPIURL, function(data){
                        console.log(data);
                        var id = data.photos.photo[0].id;
                        var farmId = data.photos.photo[0].farm;
                        var serverId = data.photos.photo[0].server;
                        var secret = data.photos.photo[0].secret;

                        var flickrPhotoURL = "https://farm" + farmId + ".staticflickr.com/" + serverId + "/" + id + "_" + secret + "_b" + ".jpg";
                        $("body").css("background-image", "url(" + flickrPhotoURL + ")");
                    });
                });
            }

            function error() {
                $(".browserLocation").html("error");
            }

            position = navigator.geolocation.getCurrentPosition(success, error);
            $(".temperature").on("click", function(){
                displayTemperature = displayTemperature == temperature ? temperature * (9/5) + 32 : temperature;
                if (displayTemperature == temperature){
                    $(".temperature").html(displayTemperature + "&deg" + "C");
                }else{
                    $(".temperature").html(displayTemperature.toPrecision(4) + "&deg" + "F");
                }
                console.log(typeof  displayTemperature);
            });
        });
        </script>

        <nav class="navbar navbar-default navbar-static-top">
          <div class="container">
            <div class="navbar-header">
              <a class="navbar-brand location" href="#">Loading...</a>
            </div>
            <div id="navbar" class="navbar-collapse">
                <p class="navbar-text weather"></p>
                <p class="navbar-text temperature"></p>
            </div>
          </div>
        </nav>
    </body>
</html>